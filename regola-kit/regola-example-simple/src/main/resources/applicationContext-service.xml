<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:lang="http://www.springframework.org/schema/lang"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd
       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd
http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang-2.0.xsd">
    
    <import resource="classpath*:/regola-config/applicationContext-service.xml" />        
    
    <!-- Add new Managers here -->

    <bean id="customerManager" class="org.regola.service.impl.CustomerManagerImpl">      
        <constructor-arg>          
            <bean class="org.regola.dao.hibernate.CustomerDaoHibernate" autowire="byType">              
                <constructor-arg value="org.regola.model.Customer"/>          
            </bean>      
        </constructor-arg>  
    </bean>
    
    <bean id="customerList"  class="org.regola.webapp.action.CustomerList" scope="session" init-method="init">
        <property name="listPage">
            <bean class="org.regola.webapp.action.ListPage"  >
                <property name="component">
                    <bean class="org.regola.webapp.action.icefaces.ListPageIceFaces">
                    </bean>
                </property>
                <property name="serviceManager" ref="customerManager" />
                <property name="eventBroker" ref="eventBroker"  />
                <property name="confirmDlg" ref="confirmDlg" />
                <property name="columnsDlg" ref="columnsDlg" />
                <property name="orderDlg" ref="orderDlg" />
            </bean>
        </property>
    </bean>
    
    
    <bean id="customerForm" class="org.regola.webapp.action.CustomerForm" scope="session" init-method="init">
        <property name="formPage"  >
            <bean class="org.regola.webapp.action.FormPage" scope="session">
                <property name="component">
                    <bean  class="org.regola.webapp.action.icefaces.FormPageIceFaces" scope="session"/>
                </property>
                <property name="serviceManager" ref="customerManager" />
                <property name="encodedId"  ref="id"/>
                <property name="eventBroker" ref="eventBroker" />
            </bean>
        </property>
        <property name="invoiceList" ref="invoiceInnerList" />
    </bean>
    
    
    <!-- Managed Bean scritti con Ruby    
   <lang:jruby id="customerList" script-interfaces="org.regola.webapp.action.ICustomerList" 
        script-source="classpath:scripts/Plug.rb"  refresh-check-delay="500" 
          scope="session" init-method="init"    >
            <lang:property name="listPage">
            <bean class="org.regola.webapp.action.ListPage"  >
                <property name="component">
                    <bean class="org.regola.webapp.action.icefaces.ListPageIceFaces">
                    </bean>
                </property>
                <property name="serviceManager" ref="customerManager" />
                <property name="eventBroker" ref="eventBroker"  />
                <property name="confirmDlg" ref="confirmDlg" />
                <property name="columnsDlg" ref="columnsDlg" />
                <property name="orderDlg" ref="orderDlg" />
            </bean>
            </lang:property>
       </lang:jruby>
       
     -->
    
    
		
	<bean id="invoiceForm" class="org.regola.webapp.action.InvoiceForm" scope="session" init-method="init">
        <property name="formPage"  >
            <bean class="org.regola.webapp.action.FormPage" scope="session">
                <property name="component">
                    <bean  class="org.regola.webapp.action.icefaces.FormPageIceFaces" scope="session"/>
                </property>
                <property name="serviceManager" ref="invoiceManager" />
                <property name="encodedId"  ref="id"/>
                <property name="eventBroker" ref="eventBroker" />
            </bean>
        </property>
        <property name="itemList" ref="itemInnerList" />
    </bean>
	

	<!-- bean id="invoiceList" class="org.regola.webapp.action.InvoiceList" scope="session" init-method="init" -->
	<!-- elimino l'init-method: inizializzazione fatta esplicitamente dopo setTarget dell'ognlDao -->
	<bean id="invoiceInnerList" class="org.regola.webapp.action.InvoiceList" scope="session">
        <property name="listPage">
            <bean class="org.regola.webapp.action.ListPage"  >
                <property name="component">
                    <bean class="org.regola.webapp.action.icefaces.ListPageIceFaces">
                    </bean>
                </property>
                <property name="serviceManager" ref="invoiceInnerManager" />
                <property name="eventBroker" ref="eventBroker"  />
                <property name="confirmDlg" ref="confirmDlg" />
                <property name="columnsDlg" ref="columnsDlg" />
                <property name="orderDlg" ref="orderDlg" />
            </bean>
        </property>
    </bean>	
    
	<bean id="invoiceList" class="org.regola.webapp.action.InvoiceList" scope="session" init-method="init">
        <property name="listPage">
            <bean class="org.regola.webapp.action.ListPage"  >
                <property name="component">
                    <bean class="org.regola.webapp.action.icefaces.ListPageIceFaces">
                    </bean>
                </property>
                <property name="serviceManager" ref="invoiceManager" />
                <property name="eventBroker" ref="eventBroker"  />
                <property name="confirmDlg" ref="confirmDlg" />
                <property name="columnsDlg" ref="columnsDlg" />
                <property name="orderDlg" ref="orderDlg" />
            </bean>
        </property>
    </bean>	
    
    
    <bean id="invoiceInnerManager" class="org.regola.service.impl.InvoiceManagerImpl">      
	    <constructor-arg>          
	        <bean class="org.regola.dao.ognl.OgnlGenericDao" autowire="byType" scope="prototype">              
	            <constructor-arg value="org.regola.model.Invoice"/>          
	        </bean>      
    </constructor-arg>  
   </bean>
   
    <bean id="invoiceManager" class="org.regola.service.impl.InvoiceManagerImpl">      
	    <constructor-arg>          
	        <bean class="org.regola.dao.hibernate.InvoiceDaoHibernate" autowire="byType">              
	            <constructor-arg value="org.regola.model.Invoice"/>          
	        </bean>      
    	</constructor-arg>  
   </bean>
    
		
	<bean id="itemForm" class="org.regola.webapp.action.ItemForm" scope="session" init-method="init">
        <property name="formPage"  >
            <bean class="org.regola.webapp.action.FormPage" scope="session">
                <property name="component">
                    <bean  class="org.regola.webapp.action.icefaces.FormPageIceFaces" scope="session"/>
                </property>
                <property name="serviceManager" ref="itemManager" />
                <property name="encodedId"  ref="id"/>
                <property name="eventBroker" ref="eventBroker" />
            </bean>
        </property>
    </bean>
	

	<bean id="itemList" class="org.regola.webapp.action.ItemList" scope="session" init-method="init" >
        <property name="listPage">
            <bean class="org.regola.webapp.action.ListPage"  >
                <property name="component">
                    <bean class="org.regola.webapp.action.icefaces.ListPageIceFaces">
                    </bean>
                </property>
                <property name="serviceManager" ref="itemManager" />
                <property name="eventBroker" ref="eventBroker"  />
                <property name="confirmDlg" ref="confirmDlg" />
                <property name="columnsDlg" ref="columnsDlg" />
                <property name="orderDlg" ref="orderDlg" />
            </bean>
        </property>
    </bean>	
    
    <!-- eliminato l'init-method: inizializzazione fatta esplicitamente dopo setTarget dell'ognlDao -->
	<bean id="itemInnerList" class="org.regola.webapp.action.ItemList" scope="session">
        <property name="listPage">
            <bean class="org.regola.webapp.action.ListPage"  >
                <property name="component">
                    <bean class="org.regola.webapp.action.icefaces.ListPageIceFaces">
                    </bean>
                </property>
                <property name="serviceManager" ref="itemInnerManager" />
                <property name="eventBroker" ref="eventBroker"  />
                <property name="confirmDlg" ref="confirmDlg" />
                <property name="columnsDlg" ref="columnsDlg" />
                <property name="orderDlg" ref="orderDlg" />
            </bean>
        </property>
    </bean>	
    
    
    <bean id="itemManager" class="org.regola.service.impl.ItemManagerImpl">      
	    <constructor-arg>          
	        <bean class="org.regola.dao.hibernate.ItemDaoHibernate" autowire="byType">              
	            <constructor-arg value="org.regola.model.Item"/>          
	        </bean>      
    </constructor-arg>  
   </bean>
   
    <bean id="itemInnerManager" class="org.regola.service.impl.ItemManagerImpl">      
	    <constructor-arg>          
	        <bean class="org.regola.dao.ognl.OgnlGenericDao" autowire="byType" scope="prototype">              
	            <constructor-arg value="org.regola.model.Item"/>          
	        </bean>      
    	</constructor-arg>  
   </bean>   
    
</beans>        	
        	



