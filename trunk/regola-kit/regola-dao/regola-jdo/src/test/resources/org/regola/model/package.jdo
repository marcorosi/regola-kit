<?xml version="1.0"?>
<!DOCTYPE jdo PUBLIC 
    "-//Sun Microsystems, Inc.//DTD Java Data Objects Metadata 2.0//EN" 
    "http://java.sun.com/dtd/jdo_2_0.dtd">
<jdo>
    <package name="org.regola.model">
    	<class name="Customer" identity-type="application" table="CUSTOMER">
            <field name="id" primary-key="true" column="ID" />
            <field name="firstName" column="FIRSTNAME" />
            <field name="lastName" column="LASTNAME" />
            <field name="address" default-fetch-group="true">
                    <embedded>
                            <field name="street" column="STREET" />
                            <field name="city" column="CITY" />
                    </embedded>
            </field>
            <field name="invoices" mapped-by="customer">
                <collection />
            </field>
            <query name="Customer.findByLastNameAndCity">
                <![CDATA[
                select where lastName == :lastName && address.city == :city                
                ]]>
            </query>

            <query name="Customer.findByAddressCity">
                <![CDATA[
                select where address.city == :address.city
                
                ]]>
            </query>

            <query name="Customer.findByAddress">
                <![CDATA[
                select where address.street == :address.street && address.city == :address.city          
                ]]>
            </query>
            <query name="Customer.findByInvoiceTotalGT">
                <![CDATA[
                select where invoices.contains(i) && i.total > :total          
                ]]>
            </query>
    	</class>
    	<class name="Customer$Address" embedded-only="true">
    		<field name="street" />
    		<field name="city" />
    	</class>
        <class name="Product" identity-type="application" table="PRODUCT">
            <field name="id" primary-key="true" column="ID" />
            <field name="name" column="NAME" />
            <field name="price" column="PRICE" />
        </class>
        <class name="Invoice" identity-type="application" table="INVOICE" objectid-class="Invoice$InvoiceId">
            <field name="id" primary-key="true" column="ID" />
            <field name="customer" column="CUSTOMERID" />
            <field name="total" column="TOTAL" />
            <field name="items" mapped-by="invoice">
                <collection />
                <order column="ITEM" mapped-by="itemNumber" />
            </field>
        </class>
        <class name="Item" identity-type="application" table="ITEM" objectid-class="Item$ItemId">
            <field name="invoice" column="INVOICEID" primary-key="true" />
            <field name="itemNumber" column="ITEM" primary-key="true" />
            
            <field name="product" column="PRODUCTID" />
            <field name="quantity" column="QUANTITY" />
            <field name="cost" column="COST" />
        </class>
    </package>
</jdo>